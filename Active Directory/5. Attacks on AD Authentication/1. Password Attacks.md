When Performing an password attacks we need to aware of account lockout mechanisms.

We can see the accounts in a system and their settings with this command although we need admin privileges to run this:
- The `net accounts` command is used in Windows to display or modify user account policies, such as password requirements and lockout settings
```
net accounts
```

### What is Password Spraying:
<p align="justify">**Password spraying** is a type of brute-force attack in which an attacker attempts to gain access to multiple accounts by trying a few commonly used passwords across many usernames. Instead of repeatedly trying different passwords on a single account (which could trigger account lockouts), the attacker tests a small number of widely used passwords (e.g., `"Password123"`, `"Welcome1"`, `"qwerty"`) across multiple accounts in an organization.</p>


### Types of Password Spraying Attacks:

#### 1.LDAP-Based Password Spraying:
- Uses **ADSI and LDAP** queries in **PowerShell**.
	##### What is ADSI:
	**ADSI** is a set of **COM (Component Object Model)** interfaces used to interact with **Active Directory (AD)** and other directory services programmatically. It allows administrators and scripts to **query, modify, and manage** directory objects like users, groups, and computers.
##### How It Works:
1. **Uses ADSI and LDAP Queries**
    
    - ADSI (`System.DirectoryServices.DirectoryEntry`) in powershell allows querying and authenticating users against AD.
    - LDAP (`LDAP://DC=corp,DC=com`) is the protocol used to interact with AD.
2. **Authentication Check with DirectoryEntry Object**
    
    - If a `DirectoryEntry` object is created successfully → **Password is correct** 
    - If an exception occurs → **Password is incorrect** 
tools: crackmapexec

#### 2.SMB-Based Password Spraying or Attacking SMB Auth:
**SMB-based password spraying** is only useful if the target Active Directory (AD) machine is running an SMB server
- Its Noisy
- **Tool:** `crackmapexec` (CME) on Kali Linux.
crackmapexec not only displays if credentials are valid, but also if the user with the identified credentials has administrative privileges on the target system

#### 3.Kerberos-Based Password Spraying:
- For this attack to work, you **must be inside the network** where the **Active Directory (AD) Domain Controller (DC)** is accessible.
- The DC runs the **Key Distribution Center (KDC)**, which processes Kerberos authentication requests.
- This requires access to **port 88 (UDP)**, which is used for Kerberos authentication.
###### How It Works 

1️⃣ Send an AS-REQ (Authentication Service Request) to the Domain Controller

- The attacker uses a tool like `kinit` (Linux) to request a **TGT** from the **Key Distribution Center (KDC)** (which is the **Domain Controller**).
- The request includes the **username** and **password**.

2️⃣ **Check the Response from the KDC**

- If the password is **correct**, the KDC responds with a **TGT** (Ticket Granting Ticket), which gets **cached** locally.
- If the password is **wrong**, the KDC sends an **error response**.

In this way we can find passwords 

### Password spraying on Linux
- crackmapexec
- kerbrute
- rpcclient

### Password spraying on windows:
- DomainPasswordSpray.ps1

###  Local Administrator Password Reuse Attack
- Many organizations **use the same local administrator password** across multiple computers.
    
- If we get **one** local admin password (or NTLM hash), we can try it on **all** machines.
```
sudo crackmapexec smb --local-auth 172.16.5.0/23 -u administrator -H 88ad09182de639ccc6579eb0849751cf | grep +
```
- `--local-auth` → Uses **local** (not domain) authentication.
    
- `172.16.5.0/23` → Targets **all IPs in the 172.16.5.0/23 range**.
    
- `-u administrator` → Uses **Administrator** account.
    
- `-H 88ad09182de639ccc6579eb0849751cf` → Tries **NTLM hash authentication** (Pass-the-Hash attack).
    
- `grep +` → Shows **successful logins**.