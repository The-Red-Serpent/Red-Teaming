### What is LLMNR:
<p align="justify">LLMNR stands for **Link-Local Multicast Name Resolution**. It is a protocol used in computer networks, primarily in local networks (LAN), to resolve hostnames to IP addresses in situations where traditional DNS (Domain Name System) is not available. LLMNR operates within a local subnet and is typically used for name resolution when a DNS server is not reachable, making it useful for smaller networks or scenarios without a central DNS server.</p>
### Key Points about LLMNR:

- **Function:** It allows computers to resolve names to IP addresses without needing a DNS server. If a computer cannot find a name in its local cache, it can send out a multicast query to resolve the name within the local network.
- **Scope:** It works within a local subnet, which means it is primarily used on small networks, such as home networks or isolated office environments.
- **Port:** It is a service that runs on machine. LLMNR uses **UDP port 5355** for communication.
- **Multicast Address:** The multicast address for LLMNR is **224.0.0.252**.

### What is LLMNR Poisoning:
<p align="justify">When a device on a local network cannot resolve a hostname through DNS (e.g., the requested name is not in the DNS cache or there is no DNS server), it may use **LLMNR** to try to resolve the name via multicast within the local subnet. The device sends a multicast query to the local network (broadcasts out to the entire local network) asking, "What is the IP address for this hostname?" Other devices on the network can respond if they have the requested information.</p>
The Attacker The attacker (us with Responder running) responds to the device  stating that it is the ''IP it was looking for" that the Device  is looking for. The attacker may send back an IP address corresponding to a **malicious server** (such as an attacker-controlled machine), instead of the correct device or server that the query was meant for.

- The host believes this reply and sends an authentication request to the attacker with a username and NTLMv2 password hash.
- This hash can then be cracked offline or used in an SMB Relay attack if the right conditions exist
- If an attacker can poison a victim’s LLMNR query to point to a malicious server, they could capture login credentials from the victim, especially if unencrypted protocols (like SMB, FTP, or HTTP) are used.

### Conditions to Perform LLMNR Poisoning
- The Device or a DC must run the llmnr service on port 5355 or any other custom port
- This Technique depends on the mistake of the user in a network.The **victim** (the user’s device) is typically trying to **connect to a network resource** like a shared printer, file server, or another device on the local network. if the user enters an wrong address. The devices broadcasts to local network. etc
### Nmap scan to identify LLMNR
```
nmap -su --script=dns-service-discovery -p <port_number> <ip>
```
### Tools used:
- Responder
- LLMNR Spoofer
- NBNSpoof
- Metasploit
- Inveigh

### Supporting Protocols:
Responder supports the following protocols:
- LLMNR 
- DNS 
- MDNS 
- NBNS 
- DHCP 
- ICMP 
- HTTP 
- HTTPS 
- SMB 
- LDAP WebDAV 
- Proxy Auth 

Responder also has support for: 
- MSSQL 
- DCE-RPC 
- FTP
- POP3 
- IMAP 
- SMTP auth

### Mitigations:
##### Disable LLMNR (Link-Local Multicast Name Resolution):

- **Group Policy (GPO) Remediation**:
    - Open **Group Policy Management** and go to:
        - `Computer Configuration` → `Administrative Templates` → `Network` → `DNS Client`.
    - Enable the policy **"Turn off Multicast Name Resolution"**.
    - This will prevent devices from using LLMNR to resolve names locally on the network.
#### Firewall:
- Use **firewalls** or **intrusion prevention systems (IPS)** to block **LLMNR (port 5355)**
- Use **Network IDS/IPS** to monitor and alert on suspicious traffic patterns, such as unexpected **LLMNR/NBT-NS** requests or SMB relay attempts.
##### Network Segmentation:

- **Isolate** devices that require LLMNR or NetBIOS for their operation (e.g., legacy systems or specific devices) into their own network segments.
- Ensure that devices that don’t need these protocols are separated from those that do, reducing the attack surface.

### Detection:
##### Inject LLMNR and NBT-NS Requests to Detect Attackers
- **Attack Simulation**:
    - You can simulate LLMNR and NBT-NS requests for **non-existent hostnames** across different subnets on your network.
    - The idea is to **"provoke" the network** into responding, and then **monitor the responses**.
    - If any device responds to these **non-existent names**, this could be an indicator that an attacker is **spoofing name resolution responses** (i.e., performing LLMNR or NBT-NS poisoning).

##### Monitor UDP Ports 5355 (LLMNR) and 137 (NBT-NS)
- **Network Traffic Monitoring**:
    - Monitor for traffic on **UDP port 5355** (which is used for LLMNR) and **UDP port 137** (used for NBT-NS).
    - If these ports are unexpectedly open or show unusual traffic patterns (like responses to non-existent hosts), this can indicate potential poisoning activity or network spoofing.

##### Monitor the Registry for Changes to LLMNR Settings
- **Registry Monitoring**:
    - The **registry key** `HKLM\Software\Policies\Microsoft\Windows NT\DNSClient` controls the **LLMNR setting** on Windows systems.
    - Specifically, you can monitor changes to the `EnableMulticast` DWORD value within this registry key.
        - A value of **1** means LLMNR is enabled.
        - A value of **0** means LLMNR is disabled.
- **Alerting for Changes**:
    - Set up alerts to notify you when the **`EnableMulticast`** setting changes from **1 to 0** (indicating that LLMNR has been disabled), or when other suspicious registry modifications are detected.