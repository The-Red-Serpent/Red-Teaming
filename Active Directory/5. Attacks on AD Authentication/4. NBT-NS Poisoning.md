### What is NetBios
<p align="justify">NetBios stands for Network Basic input/output system is a network service that enables applications on different computers to communicate with each other across a local area network (LAN)particularly for file sharing and printer sharing.</p>
<p align="justify">In Windows, the NetBIOS name is separate from the computer name and can be up to 16 characters long. Applications on other computers access NetBIOS names over  UDP a simple OSI transport layer protocol for client/server network applications based on Internet Protocol on port 137.</p>


### **Ports Used by NetBIOS:**

NetBIOS uses three specific ports for communication. These ports are used for **NetBIOS Name Resolution**, **Session Services**, and **Datagram Services**. Here's a breakdown:

1. **Port 137 (UDP)** - **NetBIOS Name Service (NBNS)**:
    
    - **Function**: This port is used for **name resolution**. It helps resolve **NetBIOS names** (e.g., `WORKSTATION01`) to **IP addresses**. Essentially, this service allows computers on a network to identify each other by names instead of IP addresses.
    - **Protocol**: **UDP** (User Datagram Protocol), which is connectionless and doesn't guarantee reliable delivery.
2. **Port 138 (UDP)** - **NetBIOS Datagram Service**:
    
    - **Function**: This port is used for **connectionless communication**. The **NetBIOS Datagram Service** allows data to be sent in a **broadcast** or to multiple computers without establishing a connection first. It is useful for sending small messages to multiple devices on the network.
    - **Protocol**: **UDP**, which is connectionless and used for broadcasting messages to other devices on the network.
3. **Port 139 (TCP)** - **NetBIOS Session Service**:
    
    - **Function**: This port is used for **connection-oriented communication**. The **NetBIOS Session Service** enables devices to establish a **session** (a reliable connection) to send data back and forth. It is typically used for file sharing and printer sharing between computers.
    - **Protocol**: **TCP** (Transmission Control Protocol), which ensures reliable, ordered delivery of data between devices.


### What is NBT-NS:
**NBT-NS** stands for **NetBIOS over TCP/IP Name Service**. It is a protocol used to **resolve NetBIOS names** (such as `WORKSTATION01`) to IP addresses on a network that uses **TCP/IP** for communication. This is used when DNS resolution failed

#### How NBT-NS Works:

1. **NetBIOS Names**: Each device on a network can be identified by a **NetBIOS name** (for example, `WORKSTATION01`, `PRINTER01`, etc.). These names are unique to the local network, and they are how computers refer to each other in older **Windows networks**.
    
2. **Name Resolution**: When one device needs to communicate with another, it first needs to resolve the **NetBIOS name** to an **IP address**. For instance, if a computer wants to connect to `\\WORKSTATION01`, it needs to know the **IP address** of that workstation. This is where **NBT-NS** comes in.
    
3. **Broadcasting**: When a computer doesn't know the IP address of a device it wants to connect to, it sends a **broadcast request** to all devices on the local network, asking "Who has the name `WORKSTATION01`?" This request is sent to the **NBT-NS** service.
    
4. **Response**: The computer that has the matching **NetBIOS name** (`WORKSTATION01` in this example) responds with its **IP address**. The requesting computer can now use this IP address to communicate directly with the other device.
    

#### Ports Used by NBT-NS:

- **Port 137 (UDP)**: NBT-NS uses **UDP port 137** to communicate over the network for name resolution. When a computer sends a query to resolve a NetBIOS name, it does so over this port.


### What is NBT-NS Poisoning
- **Victim Name Resolution Request:**
    
    - When a computer (the victim) wants to connect to another computer on the network, it needs to resolve the **NetBIOS name** (like `WORKSTATION01`) to an **IP address**.
    - The victim sends a **NetBIOS Name Query** (typically a broadcast packet) over the network to find the IP address of the device it's looking for (e.g., `\\WORKSTATION01`).
- **Spoofing the Response (by the Attacker):**
    
    - Normally, the computer that owns the name `WORKSTATION01` would respond with its **IP address**. But in an NBT-NS poisoning attack, the attacker intercepts the victim's request and sends a **false response**, claiming that it is the computer the victim is trying to reach (e.g., pretending to be `WORKSTATION01`).
    - The attacker can use a tool (such as **Responder** or **NBTScan**) to actively respond to these queries with the **attacker's IP address**, tricking the victim into thinking that the attacker is the legitimate target.
- **Victim Trusts the Spoofed Information:**
    
    - The victim **believes** the attacker's response and stores the incorrect IP address as the IP for `WORKSTATION01`.
    - This means the victim will now attempt to connect to the attacker instead of the intended target.

### Conditions for NBT-NS poisoning:
- The machines should run Netbios service on port 137
### Tools
- Nbtstat /Nbtscan(LOLBAN) - works on windows 7 or less
- Responder
- win fingerprint
- Enum4linux

### Mitigation:
#### Disable NBT-NS (NetBIOS Name Service)

- **Local Host Configuration**:
    - NBT-NS cannot be disabled directly through **Group Policy**, so it must be done on each host individually.
    - Navigate to **Network and Sharing Center** → **Change adapter settings**.
    - Right-click on the network adapter → **Properties** → **Internet Protocol Version 4 (TCP/IPv4)**.
    - Click on **Advanced**, go to the **WINS** tab, and disable **NetBIOS over TCP/IP**.

#### IPS
- Use **firewalls** or **intrusion prevention systems (IPS)** to block **LLMNR (port 5355)** and **NetBIOS (ports 137-139)** traffic at the network perimeter or between subnets.
- Monitor for traffic on **UDP port 5355** (which is used for LLMNR) and **UDP port 137** (used for NBT-NS).
- If these ports are unexpectedly open or show unusual traffic patterns (like responses to non-existent hosts), this can indicate potential poisoning activity or network spoofing.
#### Network Segmentation
- **Network segmentation** can also isolate devices that still rely on these protocols from other parts of the network, reducing the risk of an attacker exploiting them.

- **Disabling through Network Adapter Settings**: You can disable **NetBIOS over TCP/IP** in the network adapter properties on each device.
- **Group Policy**: In larger environments, it is possible to disable NetBIOS by using **Group Policy** (GPO) or scripts, preventing the service from being used on all networked devices.