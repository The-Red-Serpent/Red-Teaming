<p align="justify"> IPv6 is enabled by default in modern operating systems (since Windows Vista), and due to its preference over IPv4, systems prioritize IPv6 connections. However, many organizations may not be actively using IPv6, leaving a vulnerable attack surface.</p>

<p align="justify"> Since IPv6 is enabled by default but not necessarily used, an attacker can deploy a rogue DHCPv6 server on the network. When a device with IPv6 enabled tries to get an IP configuration (through DHCPv6), the rogue server can provide malicious configurations, such as redirecting traffic or capturing sensitive data.</p>
### **IPv6 DHCPv6 Request and Rogue Server**

- **Step 1: IPv6 Client DHCPv6 Solicit**:
    
    - A device (victim) with **IPv6 enabled** (on Windows or Linux) will periodically send out a **DHCPv6 Solicit** message looking for a **DHCPv6 server** to assign an IPv6 address and other network configurations (e.g., DNS servers).
        
    - **DHCPv6 Solicit** packet is an **ICMPv6 message** that contains:
        
        - **Client identifier** (MAC address)
        - **Option Request** for DNS servers and other settings.
- **Step 2: Attacker’s Rogue DHCPv6 Server Responds**:
    
    - The attacker running the **mitm6** tool (a man-in-the-middle IPv6 tool) listens for these DHCPv6 solicitations and responds with a **spoofed DHCPv6 Offer**.
    - The **DHCPv6 Offer** contains:
        - A **malicious IPv6 address** for the victim.
        - A **malicious DNS server address** that points to the attacker's system, rather than a legitimate DNS server.
- **Step 3: Victim Accepts the Malicious Configuration**:
    
    - The victim's machine receives the **DHCPv6 Offer** and configures itself to use the provided IPv6 address and DNS server.
    - The victim now uses the attacker’s **DNS server** for future DNS queries.

---

### **2. DNS Spoofing and Man-in-the-Middle Attack**

- **Step 4: DNS Spoofing**:
    - Because the victim is using the attacker’s DNS server, any subsequent DNS queries (for services like file sharing or web browsing) will be routed to the attacker’s server.
    - The attacker can **spoof DNS replies**, making the victim connect to fake services or malicious websites.

---

### **3. SMB Relay Attack: Credential Capture and Relaying**

- **Step 5: Victim Attempts to Access SMB Services**:
    
    - **SMB (Server Message Block)** is a protocol used by Windows devices for file sharing and other network services.
    - The victim's machine attempts to connect to a legitimate SMB service (e.g., a file share) on the network.
- **Step 6: SMB Authentication (NTLM)**:
    
    - During the SMB session initiation, the victim’s machine **authenticates** using the **NTLM (NT LAN Manager)** authentication protocol. NTLM is a challenge-response protocol used to verify identity, and it is prone to **relay attacks**.
    - The victim’s machine sends the **NTLM authentication hash** as part of the SMB session setup.
- **Step 7: Attacker Relays the NTLM Authentication**:
    
    - The attacker, running **ntlmrelayx**, intercepts the **NTLM authentication request** from the victim and **relays it** to another machine on the network (target machine).
    - The attacker’s system now **acts as a proxy** for the victim and forwards the authentication data to a system that doesn’t have SMB signing enforced.
- **Step 8: Successful Relay and Access**:
    
    - If the target system (to which the attacker relayed the authentication) accepts the **NTLM credentials**, the attacker gains unauthorized access to the target system as the victim.
    - This can lead to escalating privileges if the victim has high-level privileges (e.g., Domain Admin rights).

### Tools
 1. **mitm6**: Spoofs DHCPv6 offers to assign the victim a malicious IPv6 address and DNS server, redirecting their traffic to the attacker's machine for DNS resolution.
    
2. **ntlmrelayx**: Captures NTLM authentication attempts and relays them to a target system, exploiting weak SMB configurations to gain unauthorized access using the victim's credentials.
    
3. **Responder**: Listens for NetBIOS and LLMNR queries, then responds with fake information, tricking the victim into connecting to the attacker's machine, where it can impersonate services like SMB, HTTP, or LDAP.

### Mitigation:
- **Disable IPv6**: If IPv6 is not used, disable it across your network to prevent attackers from exploiting IPv6 features.
- **DHCPv6 Guard**: Enable **DHCPv6 Guard** on network devices (e.g., switches) to block unauthorized DHCPv6 servers.
- **SMB Signing**: Enforce **SMB signing** to prevent **SMB relay attacks**. This ensures that SMB communication is verified and cannot be hijacked.
- **Rogue Device Detection**: Use network monitoring tools to detect rogue DHCP servers or unauthorized devices (like those running mitm6).
- **Block LLMNR and NBNS**: Disable **LLMNR** and **NBNS** to prevent tools like **Responder** from capturing name resolution traffic.

### Types of Attacks we can perform
If a hacker successfully sets up a rogue DNS server, they can perform several attacks:

1. **DNS Spoofing**: Redirects users to fake websites for phishing, malware, or data theft.
2. **Man-in-the-Middle (MITM)**: Intercepts and manipulates communication between users and services.
3. **Traffic Redirection**: Sends users to malicious services or proxies, enabling further attacks.
4. **Phishing**: Directs users to fake login pages to steal credentials.
5. **Malware Distribution**: Directs users to sites that install malicious software.
6. **Denial-of-Service (DoS)**: Causes outages by redirecting users to unresponsive IPs.
7. **NTLM Relay**: Steals NTLM credentials and relays them to other systems, gaining unauthorized access.
8. **Internal Service Hijacking**: Redirects traffic to attacker-controlled internal services or shares.
9. **Bypassing Security Controls**: Circumvents firewalls or filters to inject harmful traffic.
10. **Command-and-Control**: Uses compromised systems for botnets or remote access.