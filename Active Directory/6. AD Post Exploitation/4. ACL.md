## **Understanding ACLs**

- **ACLs (Access Control Lists)** define:
    
    - **Who** can access an object
    - **What level of access** they have
- **Each ACL contains Access Control Entries (ACEs):**
    
    - **ACE maps a security principal** (user, group, or process) to **a set of permissions**.
    - **Multiple ACEs** exist in a single ACL since multiple principals can have different permissions.

### **Types of ACLs**

#### 1️⃣ **Discretionary Access Control List (DACL)**

- Defines **who can or cannot access an object**.
- Contains **ACEs** that **allow** or **deny** permissions.
- If **no DACL exists**, **everyone gets full control**.
- If a **DACL exists but has no ACEs**, **everyone is denied access**.

#### 2️⃣ **System Access Control List (SACL)**

- Used for **auditing access attempts**.
- Administrators can **log successful or failed access** to sensitive objects.

### **Access Control Entries (ACEs) in Active Directory (AD)**

An **Access Control Entry (ACE)** is a rule in an **Access Control List (ACL)** that defines permissions for a user, group, or process. ACEs are used in both **Discretionary Access Control Lists (DACLs)** and **System Access Control Lists (SACLs)**.

---

## **Types of ACEs**

|ACE Type|Used In|Purpose|
|---|---|---|
|**Access Denied ACE**|DACL|Explicitly blocks a user or group from accessing an object.|
|**Access Allowed ACE**|DACL|Explicitly grants a user or group access to an object.|
|**System Audit ACE**|SACL|Logs access attempts for auditing, whether successful or failed.|

---

## **Components of an ACE**

1. **Security Identifier (SID)**
    
    - Identifies the user, group, or process assigned to this ACE.
2. **ACE Type Flag**
    
    - Specifies whether the ACE grants, denies, or logs access.
3. **Inheritance Flags**
    
    - Defines whether child objects inherit this ACE.
4. **Access Mask (Permissions Bitmask - 32-bit value)**
    
    - Defines the specific permissions granted or denied, such as Read, Write, or Full Control.

## **Common ACE Abuses in Active Directory**

| ACE Misconfiguration    | Abuse Technique                                                                     |
| ----------------------- | ----------------------------------------------------------------------------------- |
| **GenericWrite**        | Modify non-protected attributes, assign SPN for Kerberoasting, add users to groups. |
| **WriteOwner**          | Change object ownership and take full control over the object.                      |
| **WriteDACL**           | Modify **DACL** entries to grant additional permissions.                            |
| **AllExtendedRights**   | Reset passwords (`Set-DomainUserPassword`), modify group memberships.               |
| **AddSelf**             | Allows users to add themselves to security groups.                                  |
| **GenericAll**          | Grants full control over an object (modify groups, reset passwords, Kerberoasting). |
| **ForceChangePassword** | Allows resetting a user’s password without knowing the original password.           |
![[Pasted image 20250315003646.png]]

### ACL Enumeration

### Powerview
- This command retrieves **all** ACLs within the domain and attempts to highlight the ones that might be interesting for an attacker. The output is massive.
```
Find-InterestingDomainAcl
```

- Performing Targeted enumeration on user but first we need  the sid of the user
```
$sid = Convert-NameToSid wley
```

- Finding ACL's for specific user
```
Get-DomainObjectACL -Identity * | ? {$_.SecurityIdentifier -eq $sid}
```

- The output will contain GUID's whuch we cant understans so we need to include a flag to resolve GUID's
```
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid}
```

- We can do the same with Bloodhound