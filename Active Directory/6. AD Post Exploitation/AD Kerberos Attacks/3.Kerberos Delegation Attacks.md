### Kerberos Delegation
Kerberos delegation is a feature in the **Kerberos authentication protocol** that allows a service to act **on behalf of a user** to access resources on another service. In simple terms, it lets **Service A** (like a web server) use a user's credentials to authenticate to **Service B** (like a database), as if the user had connected directly to Service B.

**Delegation** means **giving someone else permission to act on your behalf**.

#### Types
##### Unconstrained Delegation
Unconstrained delegation allows a service to impersonate a user to any other service. This type of delegation is risky because if the front-end service is compromised, it can access any resource as the user.

##### Constrained Delegation
Constrained delegation restricts the services to which the front-end service can delegate. This is configured by specifying the services that the front-end service can access on behalf of the user. This type of delegation is more secure as it limits the scope of delegation.

##### Resource-based Constrained Delegation (RBCD)
RBCD is a modern delegation method in AD where **a computer object** (like a server) specifies **which other accounts (users or machines)** can act **on its behalf**. It is **configured on the resource (target)** rather than the impersonating account.

- Instead of setting delegation on the **source service** account (like a web server), you configure it on the **target service** account (like a file server).
    
- This is **more secure** and **more flexible**, especially for environments using **non-domain joined systems or dynamic services** like containers.

**Resource-Based Constrained Delegation (RBCD)** is a type of Kerberos delegation where **the resource (target server)** decides **who is allowed to impersonate users to it**.

> **Key difference from standard constrained delegation:**

- In **standard constrained delegation**, delegation is configured on the **calling service**.
    
- In **RBCD**, it is configured on the **target service (resource)** â€” hence the term **â€œresource-based.**

[Windows Active Directory Pentest Methodology](https://r3dbuck3t.notion.site/Windows-Active-Directory-Pentest-Methodology-e8b133fb1342403aabde337b82f66fbd)

### ðŸ§° **Linux Tools for Delegation Attacks**

#### ðŸ”¹ **Impacket Scripts (Python-based)**

- `getST.py`
    
- `ticketer.py`
    
- `addcomputer.py`
    
- `rbcd.py`
    
- `getTGT.py`
    
- `secretsdump.py`
    

#### ðŸ”¹ **BloodHound (Linux GUI)**

- For mapping delegation paths (via SharpHound data)
    

#### ðŸ”¹ **ldap tools**

- `ldapsearch`
    
- `ldapmodify`
    
- `python-ldap` (custom scripts)
    

#### ðŸ”¹ **Kerberos Tools**

- `kinit`
    
- `klist`
    
- `kvno`
    
- `ktutil`

|Delegation Type|Tools|Primary Functions|
|---|---|---|
|**Unconstrained**|`secretsdump.py`, `Responder`, `rpcdump.py`|Extract TGT from memory, coerce authentication|
|**Constrained**|`getST.py`, `ticketer.py`, `ldapsearch`|Abuse S4U2Self + S4U2Proxy with correct delegation config|
|**RBCD**|`rbcd.py`, `addcomputer.py`, `getST.py`, `BloodHound`|Set RBCD, then impersonate users to target services|
