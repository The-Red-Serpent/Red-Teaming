1. **Initial Access**  
    The attacker has an account in the domain (e.g., a compromised user or service account).
    
2. **Discovery**  
    Using tools like **BloodHound** or **PowerView**, the attacker identifies that their user account has one of the following permissions over a target user account:
    
    - `GenericAll`
        
    - `GenericWrite`
        
    - `WriteProperty` (specifically over `servicePrincipalName`)
        
    - `WriteSPN`
        
    - `Validated-SPN`
        
3. **Abuse of SPN Permissions**  
    The attacker **adds a fake SPN** to the target user account, e.g.:
    
    pgsql
    
    CopyEdit
    
    `Set-ADUser -Identity <TargetUser> -ServicePrincipalNames @{Add="http/fakeSPN"}`
    
4. **Kerberos Ticket Request (TGS)**  
    The attacker requests a **TGS ticket** for the fake SPN:
    
    - Using `Rubeus`:
        
        bash
        
        CopyEdit
        
        `Rubeus.exe tgtdeleg /user:<attacker> /domain:<domain> /rc4:<NTLM hash> Rubeus.exe asktgs /service:http/fakeSPN /user:<TargetUser>`
        
5. **Ticket Extraction**  
    The ticket is encrypted with the **target user’s NTLM hash**. The attacker extracts this ticket using tools like:
    
    - `Rubeus`
        
    - `Impacket’s GetUserSPNs.py`
        
6. **Offline Cracking**  
    The attacker uses **Hashcat** or **John the Ripper** to **crack the NTLM hash** offline:
    
    pgsql
    
    CopyEdit
    
    `hashcat -m 13100 ticket.hash /path/to/wordlist`
    
7. **Credential Theft**  
    If the password is weak, the attacker recovers the **clear-text credentials** of the target user.
    
8. **Post-Exploitation**  
    With those credentials, the attacker can:
    
    - Move laterally
        
    - Elevate privileges
        
    - Access sensitive resources
9. clearing the fake spn

Tools:
- Targetedkerberoasting.py to set a fake spn and get hash
