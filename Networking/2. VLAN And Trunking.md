### What is VLAN
A virtual LAN (VLAN) is a logical overlay network that groups together a subset of devices that share a physical LAN, isolating the traffic for each group.
![[Pasted image 20250315222348.png]]


### Types
#### Port-based VLANs
Each physical port on a network switch is manually assigned to a specific VLAN. This is the most common way to set up VLANs and is often referred to as **static VLANs**.

#### Tag-based VLAN (Dynamic VLAN)
**Tag-based VLANs** use a protocol to dynamically assign devices to VLANs based on a set of criteria, such as the device’s MAC address or other network parameters. The most common tag-based protocol is **802.1Q**.

- Vlans are configured via switch
- need to create vlans and assign ports to it

### What is **Trunking** and a **Trunk Port**?

**Trunking** refers to the process of allowing multiple **VLANs (Virtual Local Area Networks)** to travel over a single physical link between network devices, such as switches. A **Trunk Port** is a port on a network switch or router that is configured to carry multiple VLANs between devices, typically using a protocol like **802.1Q** to tag each frame with its respective VLAN ID.

### Inter VLAN Routing
**Inter-VLAN Routing** is the process that allows devices in different VLANs (Virtual Local Area Networks) to communicate with each other. By default, devices in different VLANs are **isolated** because each VLAN is its own broadcast domain, meaning that **broadcast traffic** within one VLAN will not reach other VLANs.

- To enable communication between different VLANs, we need **routing**. This is where **Inter-VLAN Routing** comes into play

- To Solve this we use Router-based Inter-VLAN Routing (Router-on-a-Stick) technique
### **VLAN Troubleshooting Commands**

1. `show vlan brief` → Displays VLANs, their names, and assigned ports.
    
2. `show interfaces switchport` → Shows VLAN membership and mode (access/trunk) of an interface.
    
3. `show interfaces <interface> switchport` → Displays VLAN assignment for a specific port.
    
4. `show interfaces trunk` → Checks trunk ports, allowed VLANs, and encapsulation (802.1Q/ISL).
    
5. `show vlan id <VLAN_ID>` → Verifies if a VLAN exists and its assigned interfaces.
    
6. `show vtp status`
### **Router-on-a-Stick (RoS)**

**Router-on-a-Stick** is a networking configuration that allows a **single router** to route traffic between **multiple VLANs** using **subinterfaces** on a single physical interface. The router is connected to a **switch** via a **trunk link**, and this trunk link carries traffic for multiple VLANs between the router and the switch.

The "stick" part of "Router-on-a-Stick" refers to the router’s single physical interface (often a "stick" in the sense of a simple stick-like connection) that is used to handle all the inter-VLAN routing. This method is widely used in networks where there is a need to route traffic between VLANs but a **single physical router interface** is available.

### **What You Need for Router-on-a-Stick (RoS):**

**Hardware**:

- **Router** with one Ethernet interface.
- **Switch** that supports VLANs and trunking.
- **Devices** in each VLAN (computers, phones, etc.).

---

### **Router-on-a-Stick Configuration in a Nutshell:**

1. **Switch Configuration**:
    
    - Create **VLANs** (e.g., VLAN 10, VLAN 20).
    - Assign ports to respective VLANs.
    - Configure **trunk port** to connect to the router.
2. **Router Configuration**:
    
    - Configure the **physical interface** (no IP).
    - Create **subinterfaces** for each VLAN with an **IP address**.
    - Enable **IP routing**.
3. **Device Configuration**:
    
    - Set each device’s **default gateway** to the router’s subinterface IP.
4. **Testing**:
    
    - Test connectivity between devices in different VLANs.

### Spanning Tree Protocol
The **Spanning Tree Protocol (STP)** avoids the formation of loops or **broadcast storms**. It does so by blocking ports where it senses loop formation. In other words, the STP looks after the network to make it loop-free by tracking all the links and stopping the working of useless links.

### **Spanning Tree Protocol (STP) – Notes**

#### **Key Terms**

`Root Bridge`: A root bridge is a central Reference point in spanning tree protocol. Switch with lowest Bridge ID serves as root bridge

BridgeID = BridgePriority+ MAC Address (Default is 3278)

#### Configuration Steps:
- Enable the STP protocol
- Set Root Bridge Manually
- Set Secondary root Bridge
- Configure Port Roles and Cost
- Enable BDPU Guard
- Enable PortFast on Edgeports
- Enable Root Guard
### Types of Ports:
 `Root Port` : This is the port used to  connect to the root bridge
 `Designated Ports:`  The best Forwarding port on each segment 
 `Blocking Port`: Prevents  loops by blocking the redundant port.

Root Ports, Designated port and Blocking port are set automatically
### **1. Selecting the Root Bridge**

- The switch with the lowest Bridge ID (Priority + MAC) becomes the Root Bridge.
- If priority is the same, the lowest MAC address is considered.
### **2. Selecting the Root Port (RP)**

- Each non-root switch selects one Root Port (RP) – the port with the lowest path cost to the Root Bridge.
- **Path Cost Table** (based on link speed):
    - 10 Mbps = 100
    - 100 Mbps = 19
    - 1 Gbps = 4
    - 10 Gbps = 2

### **3. Selecting Designated and Non-Designated Ports**

- **Designated Port (DP)** – Best forwarding port on a network segment.
- **Non-Designated Port (Blocked Port)** – Prevents loops.

**Selection Rules:**

- The Root Bridge has all Designated Ports.
- On each network segment, the switch with the lowest cost path to the Root Bridge has the Designated Port.
- If cost is equal, the switch with the lower Bridge ID wins.

Blocked ports do not forward traffic but listen to BPDUs.

---
![[Pasted image 20250321203626.png]]

### **Bridge Protocol Data Unit (BPDU)**

**BPDU (Bridge Protocol Data Unit)** is a network message used by **Spanning Tree Protocol (STP)** to prevent loops in a switched networks and manage network topology. Switches Exchange BPDU'S to determine the root bridge, calculate costs & decides which ports should be in forwarding or blocking state.
### **Types of BPDUs**

1. **Configuration BPDU** – Used for **Root Bridge election** and STP topology updates.
2. **Topology Change Notification (TCN) BPDU** – Sent when a **topology change** occurs (e.g., link failure).
### **BPDU Contents**

A BPDU contains the following key fields:

- **Root Bridge ID** – Identifies the current Root Bridge.
- **Sender Bridge ID** – The Bridge ID of the switch sending the BPDU.
- **Path Cost** – Cost to reach the Root Bridge.
- **Port ID** – Identifies the port sending the BPDU.
- **Message Age** – Time since the BPDU was generated.
- **Max Age, Hello Time, and Forward Delay** – Timers used for STP convergence.

`BPD Guard` is a security feature in STP that protects  access ports by disabling them if they receive BPDU packets 

### **STP Troubleshooting Commands**

7. `show spanning-tree` → Displays STP mode, root bridge, and timers for all VLANs.
    
8. `show spanning-tree vlan <VLAN_ID>` → Checks STP status for a specific VLAN.
    
9. `show spanning-tree root` → Shows the root bridge for each VLAN.
    
10. `show spanning-tree interface <interface>` → Displays STP role (Root, Designated, Blocking) for a port.
    
11. `show spanning-tree inconsistentports` → Lists ports blocked due to BPDU Guard or Root Guard.
    
12. `show spanning-tree interface <interface> detail` → Monitors BPDU activity on a specific port.
    

---

### **Debug Commands (Use with Caution in Production)**

13. `debug spanning-tree events` → Shows STP state transitions in real-time.
    
14. `debug spanning-tree bpdu` → Monitors BPDU packets received/sent on interfaces.
    
15. `debug vlan trunk` → Tracks trunk negotiation and VLAN pruning issues.